# 出題意図

この問題は、税金計算システムのリファクタリングを通じて、テーブル駆動メソッド（Table-Driven Methods）、データ駆動プログラミング、ルックアップテーブルの活用を学習することを目的としています。

## 適用されたテーマ

1. **テーブル駆動メソッド (Table-Driven Methods)** - Code Complete
   - 複雑な条件分岐をデータテーブルで置き換え
   - TaxTableRegistry、DeductionTableRegistryでデータベース的なアプローチ

2. **データ駆動プログラミング** - プリンシパル オブ プログラミング
   - ロジックとデータの分離
   - 設定データの外部化による保守性向上

3. **ルックアップテーブル** - Code Complete
   - ハッシュマップによる高速な値の検索
   - O(1)の検索時間による性能向上

4. **単一責任の原則 (SRP)** - プリンシパル オブ プログラミング
   - TableBuilder: テーブル構築専用
   - ProgressiveTaxCalculator: 累進税計算専用
   - TaxBracket: 税率区分の表現専用

5. **ファクトリーパターン** - Practical Software Engineering Ch14
   - CountryTaxProcessorで国別処理クラスを生成
   - TableBuilderで複雑なテーブル構築を隠蔽

6. **設定パターン (Configuration Pattern)** - プリンシパル オブ プログラミング
   - TaxSystemConfigurationで有効年度、対応国、申告区分を管理
   - 制約事項の一元管理

7. **値オブジェクト** - Code Complete
   - TaxContext, DeductionContext, TaxBracket
   - ドメインの概念をオブジェクトで表現

8. **戦略パターン (Strategy Pattern)** - Practical Software Engineering Ch14
   - 国別のTaxProcessorクラス
   - 異なる税制システムへの対応

9. **ビルダーパターン** - Practical Software Engineering Ch14
   - TableBuilder, DeductionTableBuilderで複雑なデータ構造を段階的に構築
   - 可読性の高いテーブル定義

10. **DRYの原則** - プリンシパル オブ プログラミング
    - 重複した税率計算ロジックを統一
    - 共通パターンのメソッド抽出

11. **Open-Closed原則 (OCP)** - プリンシパル オブ プログラミング
    - 新しい国や年度の追加が既存コードの変更なしに可能
    - テーブルデータの追加のみで機能拡張

12. **抽出クラス** - Refactoring
    - 大きなクラスから専門性の高いクラスを分離
    - 関連するデータと操作をまとめて抽出

## テーブル駆動メソッドの利点

### 1. **保守性の向上**
- 税率変更時にコードではなくデータのみを変更
- 新しい税制区分の追加が容易

### 2. **パフォーマンスの向上**
- ハッシュテーブルによるO(1)の検索
- 複雑な条件分岐の排除

### 3. **テスタビリティの向上**
- データとロジックの分離によりテストが容易
- モックデータによる境界値テスト

### 4. **可読性の向上**
- 税率テーブルがデータとして明確に表現
- ビジネスルールの理解が容易

## データ駆動設計のベストプラクティス

### 1. **設定の外部化**
```ruby
TAX_BRACKETS = {
  'US_2023_single' => [
    { income_range: 0..11000, rate: 0.10 }
  ]
}.freeze
```

### 2. **キーの標準化**
- 一貫したキー命名規則
- 国_年度_申告区分の形式

### 3. **エラーハンドリング**
- サポートされていない組み合わせの明示的な処理
- フォールバック値の提供

### 4. **データの検証**
- テーブルデータの整合性チェック
- 重複区間の検出

この設計により、複雑な税制システムを拡張可能で保守しやすい形で実装できます。