# 出題意図

この問題は、CSVファイル処理のリファクタリングを通じて、ファイル処理のベストプラクティス、バリデーションと変換の分離、標準ライブラリの活用を学習することを目的としています。

## 適用されたテーマ

1. **標準ライブラリの活用** - プリンシパル オブ プログラミング（車輪の再発明を避ける）
   - RubyのCSVライブラリを使用して安全なパース
   - 手動のsplitよりもエスケープ処理などが適切

2. **単一責任の原則 (SRP)** - プリンシパル オブ プログラミング
   - FileValidator: ファイルの検証
   - CSVProcessor: CSV処理の調整
   - RowValidator: 行単位の検証
   - RowTransformer: データ変換

3. **バリデーションと変換の分離** - Refactoring
   - 検証ロジックと変換ロジックを別クラスに
   - それぞれが独立してテスト可能

4. **ガード節** - Tidy First?
   - ファイル存在チェックで早期リターン
   - ネストの減少と読みやすさの向上

5. **名前付き定数** - Code Complete
   - MAX_FILE_SIZE, EMAIL_REGEXなど
   - マジックナンバーや正規表現を明確に

6. **例外処理の適切な使用** - プリンシパル オブ プログラミング
   - CSV::MalformedCSVErrorを捕捉して適切なエラーメッセージ
   - 各レベルで適切な例外処理

7. **Tell, Don't Ask原則** - プリンシパル オブ プログラミング
   - File.zero?やmatch?などの述語メソッドを活用
   - オブジェクトに判断を委譲

8. **ループをイテレータに置き換える** - Refactoring
   - forループをCSV.foreachに置き換え
   - with_indexで行番号も同時に取得

9. **メソッドの抽出** - Refactoring
   - 大きなprocess_csvメソッドを小さなメソッドに分割
   - 各メソッドが明確な意図を持つ

10. **データクラスの活用** - Code Complete
    - CSV::Rowオブジェクトを活用してデータアクセス
    - ハッシュへの変換も容易にto_hメソッドで実現