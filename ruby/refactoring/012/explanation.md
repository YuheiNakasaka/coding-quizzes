# 出題意図

この問題は、認証システムのリファクタリングを通じて、セキュリティのベストプラクティス、責任の分離、セキュアなコーディングを学習することを目的としています。

## 適用されたテーマ

1. **単一責任の原則 (SRP)** - プリンシパル オブ プログラミング
   - PasswordVerifier: パスワード検証
   - AccountLocker: アカウントロック管理
   - SessionManager: セッション管理

2. **セキュリティのベストプラクティス** - プリンシパル オブ プログラミング（安全性原理）
   - SecureRandomを使用して安全なトークン生成
   - パスワードの平文保存を避ける（コメントで注意）
   - エラーメッセージの統一で情報漏洩を防ぐ

3. **名前付き定数** - Code Complete
   - MAX_FAILED_ATTEMPTS, LOCK_DURATION, SESSION_DURATION
   - マジックナンバーを排除し意図を明確に

4. **ガード節** - Tidy First?
   - ユーザー存在チェックで早期リターン
   - ネストの減少と読みやすさの向上

5. **Tell, Don't Ask原則** - プリンシパル オブ プログラミング
   - locked?メソッドで状態確認をカプセル化
   - increment!メソッドでアトミックな更新

6. **依存性注入** - Practical Software Engineering
   - 各コンポーネントを外部から注入
   - テスタビリティとモックの作成が容易

7. **ActiveRecordパターンの活用** - メタプログラミングRuby
   - update, increment!などのActiveRecordメソッドを活用
   - Railsの慣習に従ったコード

8. **nilガードの改善** - メタプログラミングRuby
   - == nilの代わりにunlessや?メソッドを使用
   - Rubyらしいイディオマティックなコード

9. **メソッドの抽出** - Refactoring
   - 大きなloginメソッドを小さなメソッドに分割
   - 各メソッドが明確な意図を持つ

10. **時間計算の明確化** - Code Complete
    - 30 * 60, 24 * 60 * 60のように意図を明確に
    - 秒単位の数値を理解しやすく表現