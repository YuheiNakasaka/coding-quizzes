# 出題意図

この問題は、売上レポート出力システムのコードをオブジェクト指向設計の原則に基づいてリファクタリングすることで、以下のプログラミング原則とテーマを学習することを目的としています。

## 適用されたテーマ

1. **ポリモーフィズム (Polymorphism)** - オブジェクト指向設計
   - 条件分岐（if/elsif/else）をポリモーフィックなメソッド呼び出しに置き換え
   - 各出力フォーマットを独立したクラスとして実装
   - 同じインターフェース（generate等）を異なる振る舞いで実装

2. **継承による共通処理の抽出** - オブジェクト指向設計の基本
   - 基底クラス（ReportFormatter）に共通のロジックを配置
   - サブクラスで差分のみをオーバーライド
   - Template Methodパターンの活用

3. **Open/Closed原則** - SOLID原則
   - 新しい出力フォーマットの追加が既存コードの変更なしで可能
   - 拡張に対して開いている（新しいReportFormatterサブクラスを追加できる）
   - 修正に対して閉じている（既存のフォーマッタークラスを変更不要）

4. **単一責任の原則 (SRP)** - SOLID原則
   - 各フォーマッタークラスは自身の出力形式のみに責任を持つ
   - ReportFormatterFactoryはオブジェクト生成の責任のみを持つ
   - ReportGeneratorはクライアントへのインターフェースのみを提供

5. **Strategy パターン** - デザインパターン
   - 出力フォーマットごとに異なる生成アルゴリズムをカプセル化
   - 実行時に適切なストラテジー（出力フォーマット）を選択
   - アルゴリズムの独立した変更とテストが可能

6. **Factory パターン** - デザインパターン
   - ReportFormatterFactoryが適切なReportFormatterオブジェクトの生成を担当
   - オブジェクト生成ロジックを一箇所に集約
   - クライアントコードからオブジェクト生成の詳細を隠蔽

7. **条件分岐の排除** - Refactoring
   - 繰り返し出現するif/elsif/elseを削減
   - コードの見通しを改善し、バグの混入を防ぐ
   - 各クラスが独立してテスト可能に

8. **明証原理** - プリンシプル オブ プログラミング
   - 各クラス名が役割を明確に表現（CsvFormatter、JsonFormatter等）
   - メソッド名が意図を明確に表現（format_header、format_body等）
   - コードの意図が読むだけで理解できる

9. **カプセル化** - オブジェクト指向設計
   - 各出力フォーマットの詳細なロジックをクラス内に隠蔽
   - 外部からは統一されたインターフェースのみを公開
   - 内部実装の変更が外部に影響しない

## リファクタリングの効果

### Before (問題コード)
- 条件分岐が多く、コードの見通しが悪い
- 新しい出力フォーマットの追加時に既存メソッドの変更が必要
- 各出力フォーマットのロジックが散在し、保守が困難
- テストが書きにくい（全ての条件分岐を網羅する必要がある）

### After (解答コード)
- 各出力フォーマットが独立したクラスとして実装され、責務が明確
- 新しい出力フォーマットの追加は新しいクラスの作成のみで対応可能
- 各クラスが小さく、理解しやすい
- 各出力フォーマットを独立してテストできる
- ポリモーフィズムによりクライアントコードがシンプルに

## 学習のポイント

この問題を通じて、以下を学ぶことができます：

1. **いつ継承を使うべきか**: 共通の振る舞いと差分の振る舞いがある場合
2. **ポリモーフィズムの威力**: 条件分岐を減らし、拡張性を高める
3. **デザインパターンの実践**: Strategy、Factory、Template Methodの実用例
4. **SOLID原則の実践**: 特にOpen/Closed原則とSRPの効果
5. **オブジェクト指向設計の思考法**: データと振る舞いをオブジェクトとしてモデリング

## 参考文献

- 『オブジェクト指向のこころ』(Design Patterns Explained)
- 『リファクタリング』(Refactoring) - Martin Fowler
- 『アジャイルソフトウェア開発の奥義』(Agile Software Development) - Robert C. Martin
- 『プリンシプル オブ プログラミング』
