# 出題意図

この問題は、売上データの集計処理をリファクタリングすることで、関数型プログラミングの概念とRubyのコレクション操作を学習することを目的としています。

## 適用されたテーマ

1. **ループをパイプラインに置き換える** - Refactoring
   - forループをRubyのEnumerableメソッドに置き換え
   - reject, select, sum, mapなどの高階関数を活用

2. **DRY原則 (Don't Repeat Yourself)** - プリンシプル オブ プログラミング
   - "cancelled"ステータスのフィルタリング処理を一元化
   - 共通の集計ロジックを再利用

3. **単一責任の原則 (SRP)** - プリンシプル オブ プログラミング
   - 各メソッドが1つの明確な責任を持つ
   - フィルタリング、合計、平均、最大値などを別メソッドに

4. **宣言型の表現** - プリンシプル オブ プログラミング
   - 「どのように」ではなく「何を」を表現
   - 命令型のループから宣言型のコレクション操作へ

5. **Symbol to Proc** - メタプログラミングRuby
   - sum { |sale| sale[:amount] }のようなブロック構文の活用
   - Rubyの表現力を最大限に活用

6. **ガード節** - Tidy First?
   - sales.empty?による早期リターン
   - ゼロ除算を防ぐ防御的プログラミング

7. **メソッドの抽出** - Refactoring
   - 大きなgenerate_reportメソッドを小さなメソッドに分割
   - 各メソッドが明確な名前を持ち、意図を伝える

8. **機能的独立性** - Practical Software Engineering
   - 各メソッドが他のメソッドに依存せず独立
   - calculate_totalを他のメソッドから再利用

9. **データ変換のパイプライン** - UNIX哲学
   - 入力データを段階的に変換して出力を生成
   - filter -> transform -> aggregateのパターン

10. **名前重要** - プリンシプル オブ プログラミング
    - filter_valid_sales, calculate_vip_salesなどの説明的な名前
    - コメント不要な自己文書化コード